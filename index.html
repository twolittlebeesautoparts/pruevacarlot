<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>EINSTEIN AUTO SALES LLC</title>
<meta name="description" content="EINSTEIN AUTO SALES LLC ‚Äî Clean, modern inventory with admin tools. 401 S Tibbs Ave. Call (317) 492-9196." />
<meta name="color-scheme" content="dark">
<meta name="theme-color" content="#0b1220" />

<style>
:root{
  --bg:#070b12;
  --bg2:#0b1220;
  --panel:#0f1a2e;
  --panel2:#0b1526;
  --card:#0f192b;
  --row:#0b1424;

  --text:#f5f7fb;
  --muted:#a7b0c0;

  --blue:#2f6cff;        /* metallic blue */
  --blue2:#1f55d7;
  --red:#b21f2d;         /* dark red accent */
  --red2:#7f1720;

  --border:rgba(255,255,255,.10);
  --border2:rgba(255,255,255,.14);
  --shadow:0 18px 60px rgba(0,0,0,.55);
  --radius:18px;
  --radius2:14px;
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;max-width:100%;overflow-x:hidden}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:
    radial-gradient(900px 520px at 12% -10%, rgba(47,108,255,.22), transparent 60%),
    radial-gradient(900px 520px at 92% 0%, rgba(178,31,45,.16), transparent 60%),
    linear-gradient(180deg, var(--bg), var(--bg2));
  color:var(--text);
  padding-bottom:calc(24px + env(safe-area-inset-bottom));
}

/* Layout */
.container{max-width:1200px;margin:auto;padding:0 16px}
.section{padding:34px 0}
.grid{display:grid;gap:16px}

/* Header */
header{
  position:sticky; top:0; z-index:1000;
  background:rgba(7,11,18,.78);
  backdrop-filter:blur(12px);
  border-bottom:1px solid rgba(255,255,255,.08);
}
.header-inner{
  display:flex; align-items:center; justify-content:space-between;
  gap:14px; padding:12px 0;
}
.brand{
  display:flex; align-items:center; gap:12px;
  min-width:240px;
}
.brand .logo{
  height:46px; width:auto; display:block;
  border-radius:12px;
  border:1px solid var(--border);
  background:#0a1222;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.brandText h1{
  font-size:14px; letter-spacing:.6px; font-weight:950;
}
.brandText .sub{font-size:11px;color:var(--muted);margin-top:2px}

/* Nav */
.nav{
  display:flex; gap:8px; align-items:center; flex-wrap:wrap;
}
.pill{
  text-decoration:none;
  border:1px solid var(--border);
  color:var(--text);
  background:rgba(15,26,46,.55);
  padding:10px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:900;
  display:inline-flex; align-items:center; gap:8px;
  cursor:pointer;
}
.pill:hover{border-color:var(--border2)}
.pill.primary{
  border:none;
  background:linear-gradient(180deg,var(--blue),var(--blue2));
}
.pill.red{
  border:none;
  background:linear-gradient(180deg,var(--red),var(--red2));
}
.pill.ghost{
  background:transparent;
}
.menuBtn{display:none}

/* Hero */
.hero{
  padding:34px 0 10px;
}
.heroWrap{
  display:grid; gap:16px;
  grid-template-columns:1.15fr .85fr;
  align-items:stretch;
}
.heroCard{
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)), var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:22px;
  box-shadow:var(--shadow);
}
.heroTitle{
  font-size:clamp(1.9rem, 4.3vw, 3.0rem);
  font-weight:980;
  line-height:1.04;
  letter-spacing:.2px;
}
.heroLead{
  margin-top:12px;
  color:var(--muted);
  max-width:60ch;
  line-height:1.45;
}
.heroBtns{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
.heroStats{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
  margin-top:18px;
}
.stat{
  background:rgba(11,21,38,.62);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  text-align:center;
}
.stat b{display:block;color:#fff;font-weight:980;font-size:14px}
.stat span{display:block;color:var(--muted);font-size:11px;margin-top:4px}

.sideCard{
  background:linear-gradient(180deg, rgba(47,108,255,.12), rgba(255,255,255,.02)), var(--card);
  border:1px solid rgba(47,108,255,.25);
  border-radius:var(--radius);
  padding:22px;
  box-shadow:var(--shadow);
}
.badge{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(47,108,255,.30);
  background:rgba(47,108,255,.12);
  font-size:12px;
  font-weight:950;
}
.sideCard h3{margin-top:12px;font-size:16px;font-weight:980}
.sideCard p{margin-top:10px;color:var(--muted);line-height:1.45}
.sideList{margin-top:12px;display:grid;gap:10px}
.sideItem{
  display:flex;justify-content:space-between;gap:12px;
  background:rgba(11,21,38,.65);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
}
.sideItem .k{color:var(--muted);font-size:12px;font-weight:900}
.sideItem .v{font-size:12px;font-weight:980}

/* Cards */
.card{
  background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)), var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:18px;
  box-shadow:var(--shadow);
}
.card h2{font-size:16px;font-weight:980}
.card p{margin-top:10px;color:var(--muted);line-height:1.6}

/* Inventory */
.tools{
  display:flex; gap:10px; flex-wrap:wrap; align-items:center;
  margin-top:14px;
}
.input, select, textarea{
  width:100%;
  padding:12px 12px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#091225;
  color:var(--text);
  font-size:13px;
}
.input:focus, select:focus, textarea:focus{
  outline:none;
  border-color:rgba(47,108,255,.55);
  box-shadow:0 0 0 4px rgba(47,108,255,.16);
}
.toolRow{
  display:grid;
  grid-template-columns: 1.2fr .8fr .8fr;
  gap:10px;
  width:100%;
}
.invGrid{
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:14px;
  margin-top:14px;
}
.vehicleCard{
  background:rgba(11,21,38,.62);
  border:1px solid var(--border);
  border-radius:18px;
  overflow:hidden;
  box-shadow:0 10px 30px rgba(0,0,0,.28);
  display:grid;
}
.thumb{
  height:180px;
  background:linear-gradient(135deg, rgba(47,108,255,.12), rgba(178,31,45,.08)), #0a1222;
  border-bottom:1px solid rgba(255,255,255,.06);
  cursor:pointer;
  position:relative;
}
.thumb img{width:100%;height:100%;object-fit:cover;display:block}
.noimg{
  height:100%;
  display:grid;
  place-items:center;
  font-weight:950;
  color:rgba(255,255,255,.55);
}
.priceBadge{
  position:absolute; left:10px; top:10px;
  padding:8px 10px;
  border-radius:999px;
  background:rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.14);
  font-size:12px;
  font-weight:980;
  backdrop-filter:blur(10px);
}
.milesBadge{
  position:absolute; right:10px; top:10px;
  padding:8px 10px;
  border-radius:999px;
  background:rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.14);
  font-size:12px;
  font-weight:980;
  backdrop-filter:blur(10px);
}
.vBody{padding:14px}
.vTitle{font-weight:980;font-size:14px;line-height:1.2}
.vMeta{color:var(--muted);font-size:12px;margin-top:6px;line-height:1.4}
.tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.tag{
  font-size:10px;
  padding:5px 8px;
  border-radius:999px;
  border:1px solid var(--border);
  color:var(--muted);
  font-weight:950;
  background:rgba(7,11,18,.25);
}
.vActions{
  display:flex; gap:10px;
  padding:12px 14px 14px;
}
.smallBtn{
  flex:1;
  padding:10px 10px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#091225;
  color:var(--text);
  font-weight:980;
  cursor:pointer;
  font-size:12px;
}
.smallBtn.primary{border:none;background:linear-gradient(180deg,var(--blue),var(--blue2))}
.smallBtn.danger{border:none;background:linear-gradient(180deg,var(--red),var(--red2))}
.smallBtn:active{transform:scale(.99)}

/* Modal */
.modalWrap{
  position:fixed; inset:0;
  display:none;
  background:rgba(0,0,0,.55);
  backdrop-filter:blur(8px);
  z-index:2000;
  padding:16px;
}
.modal{
  max-width:980px; margin:40px auto;
  background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)), var(--panel2);
  border:1px solid rgba(255,255,255,.14);
  border-radius:22px;
  box-shadow:0 24px 80px rgba(0,0,0,.7);
  overflow:hidden;
}
.modalTop{
  display:flex; justify-content:space-between; align-items:center; gap:12px;
  padding:14px 16px;
  border-bottom:1px solid rgba(255,255,255,.10);
}
.modalTop b{font-weight:980}
.modalClose{
  width:40px;height:40px;border-radius:12px;
  border:1px solid var(--border);
  background:#091225; color:var(--text);
  font-weight:980; cursor:pointer;
}
.modalBody{
  display:grid;
  grid-template-columns: 1.1fr .9fr;
  gap:0;
}
.gallery{
  background:#05080f;
  border-right:1px solid rgba(255,255,255,.08);
}
.gMain{height:360px; background:#000}
.gMain img{width:100%;height:100%;object-fit:cover;display:block}
.gThumbs{
  display:flex; gap:10px;
  padding:12px;
  overflow:auto;
}
.gThumbs img{
  width:92px;height:62px;object-fit:cover;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  cursor:pointer;
  opacity:.85;
}
.gThumbs img.active{outline:2px solid rgba(47,108,255,.75); opacity:1}
.details{
  padding:16px;
}
.dTitle{font-size:18px;font-weight:980}
.dSub{color:var(--muted);margin-top:8px;line-height:1.45}
.dGrid{
  margin-top:14px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.dItem{
  background:rgba(7,11,18,.35);
  border:1px solid rgba(255,255,255,.10);
  border-radius:14px;
  padding:12px;
}
.dItem .k{color:var(--muted);font-size:11px;font-weight:950}
.dItem .v{margin-top:6px;font-size:13px;font-weight:980}
.modalBtns{
  margin-top:14px;
  display:flex; gap:10px; flex-wrap:wrap;
}
.noteBox{
  margin-top:12px;
  background:rgba(7,11,18,.35);
  border:1px solid rgba(255,255,255,.10);
  border-radius:14px;
  padding:12px;
  color:var(--muted);
  line-height:1.55;
  font-size:13px;
}

/* Admin panel */
.adminBar{
  display:none;
  margin-top:14px;
  border-top:1px dashed rgba(255,255,255,.12);
  padding-top:14px;
}
.formGrid{
  display:grid;
  grid-template-columns:repeat(4, 1fr);
  gap:10px;
  margin-top:12px;
}
.formGrid .wide{grid-column:span 2}
.formGrid .full{grid-column:1/-1}
.adminActions{
  display:flex; gap:10px; flex-wrap:wrap;
  margin-top:12px;
}
.help{
  margin-top:10px;
  color:var(--muted);
  font-size:12px;
  line-height:1.45;
}
.hr{height:1px;background:rgba(255,255,255,.10);margin-top:14px}

/* Toast */
.toast{
  position:fixed; left:50%; transform:translateX(-50%);
  bottom:calc(14px + env(safe-area-inset-bottom));
  background:rgba(10,18,34,.92);
  border:1px solid rgba(255,255,255,.14);
  color:var(--text);
  padding:10px 12px;
  border-radius:12px;
  font-weight:950;
  font-size:12px;
  display:none;
  z-index:5000;
  box-shadow:0 16px 50px rgba(0,0,0,.5);
}

/* Footer */
footer{
  border-top:1px solid rgba(255,255,255,.08);
  padding:24px 0;
  margin-top:30px;
  color:var(--muted);
}
.footerGrid{
  display:grid;
  grid-template-columns:1.2fr .8fr;
  gap:16px;
  align-items:start;
}
.small{font-size:12px;line-height:1.55}

/* Mobile */
@media(max-width:1000px){
  .heroWrap{grid-template-columns:1fr}
  .invGrid{grid-template-columns:repeat(2,1fr)}
  .modalBody{grid-template-columns:1fr}
  .gallery{border-right:none;border-bottom:1px solid rgba(255,255,255,.08)}
  .gMain{height:320px}
  .formGrid{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:640px){
  .invGrid{grid-template-columns:1fr}
  .heroStats{grid-template-columns:1fr}
  .toolRow{grid-template-columns:1fr}
  .menuBtn{display:inline-flex}
  .nav{display:none; width:100%}
  .nav.open{display:flex}
  .header-inner{flex-wrap:wrap}
  .brand{min-width:0}
}

/* Reduce motion */
@media (prefers-reduced-motion: reduce){
  *{scroll-behavior:auto !important}
}
</style>
</head>

<body>
<div class="toast" id="toast">Saved</div>

<header>
  <div class="container header-inner">
    <div class="brand">
      <img
        src="https://raw.githubusercontent.com/twolittlebeesautoparts/pruevacarlot/main/logo.png"
        class="logo"
        alt="Einstein Auto Sales LLC Logo"
        onerror="this.style.display='none';"
      >
      <div class="brandText">
        <h1>EINSTEIN AUTO SALES LLC</h1>
        <div class="sub">401 S Tibbs Ave ‚Ä¢ Indianapolis ‚Ä¢ (317) 492-9196</div>
      </div>
    </div>

    <button class="pill menuBtn" type="button" onclick="toggleMenu()">Menu</button>

    <nav class="nav" id="nav">
      <a class="pill" href="#about">About Us</a>
      <a class="pill primary" href="#inventory">Inventory</a>
      <a class="pill" href="https://www.google.com/maps?q=401+S+Tibbs+Ave,+Indianapolis,+IN" target="_blank" rel="noopener">Get Directions</a>
      <a class="pill ghost" href="tel:3174929196">Call</a>
      <button class="pill red" type="button" onclick="openLogin()">Admin</button>
    </nav>
  </div>
</header>
<main>
  <section class="hero">
    <div class="container heroWrap">
      <div class="heroCard">
        <div class="heroTitle">Think Smarter.<br>Drive Better.<br>Buy Confident.</div>
        <div class="heroLead">
          Browse our vehicles, view full specs, and call instantly.
          Built for speed and clarity ‚Äî like a top dealership.
        </div>

        <div class="heroBtns">
          <a class="pill primary" href="#inventory">Browse Inventory</a>
          <a class="pill ghost" href="tel:3174929196">Call (317) 492-9196</a>
          <a class="pill" href="https://www.google.com/maps?q=401+S+Tibbs+Ave,+Indianapolis,+IN" target="_blank" rel="noopener">Directions</a>
        </div>

        <div class="heroStats">
          <div class="stat"><b>Clean UI</b><span>Fast on mobile</span></div>
          <div class="stat"><b>Photo-first</b><span>See the car</span></div>
          <div class="stat"><b>Easy admin</b><span>Add inventory fast</span></div>
        </div>
      </div>

      <div class="sideCard">
        <div class="badge">üìç 401 S Tibbs Ave</div>
        <h3>Visit or call ‚Äî quick response</h3>
        <p>
          EINSTEIN AUTO SALES LLC is focused on clean listings, honest info, and fast communication.
        </p>
        <div class="sideList">
          <div class="sideItem"><div class="k">Phone</div><div class="v">(317) 492-9196</div></div>
          <div class="sideItem"><div class="k">Directions</div><div class="v">Google Maps</div></div>
          <div class="sideItem"><div class="k">Inventory</div><div class="v">Updated in admin</div></div>
        </div>
      </div>
    </div>
  </section>

  <section id="about" class="section">
    <div class="container">
      <div class="card">
        <h2>About Us</h2>
        <p>
          we approach vehicle sales the same way
Einstein approached problems ‚Äî with clarity, logic, and no unnecessary noise.
Our goal is simple: make car buying smarter, faster, and more transparent.
        </p>
      </div>
    </div>
  </section>

  <section id="inventory" class="section">
    <div class="container">
      <div class="card">
        <h2>Inventory</h2>

        <div class="tools">
          <div class="toolRow">
            <input class="input" id="q" placeholder="Search: year, make, model, color, VIN, stock‚Ä¶" oninput="renderInventory()">
            <select id="sort" onchange="renderInventory()">
              <option value="newest">Sort: Newest</option>
              <option value="priceAsc">Price: Low ‚Üí High</option>
              <option value="priceDesc">Price: High ‚Üí Low</option>
              <option value="milesAsc">Miles: Low ‚Üí High</option>
              <option value="milesDesc">Miles: High ‚Üí Low</option>
            </select>
            <select id="filter" onchange="renderInventory()">
              <option value="all">Filter: All</option>
              <option value="available">Available</option>
              <option value="sold">Sold</option>
            </select>
          </div>
        </div>

        <div class="help" id="invHint"></div>
        <div class="invGrid" id="invGrid"></div>

        <!-- Admin bar -->
        <div class="adminBar" id="adminBar">
          <div class="hr"></div>
          <h2 style="margin-top:14px">Admin Panel</h2>
          <div class="help">
            Add vehicles with photos. This version stores data in your browser (works on GitHub Pages). For global saving for everyone, we can connect Firebase later.
          </div>

          <div class="formGrid">
            <input id="status" class="input" placeholder="Status: Available / Sold (default Available)">
            <input id="year" class="input" placeholder="Year (e.g. 2017)">
            <input id="make" class="input" placeholder="Make">
            <input id="model" class="input" placeholder="Model">
            <input id="trim" class="input" placeholder="Trim">
            <input id="price" class="input" placeholder="Price (e.g. 12995)">
            <input id="miles" class="input" placeholder="Miles (e.g. 88420)">
            <input id="color" class="input" placeholder="Color">
            <input id="engine" class="input" placeholder="Engine (e.g. 2.4L I4)">
            <input id="trans" class="input" placeholder="Transmission">
            <input id="drive" class="input" placeholder="Drivetrain">
            <input id="stock" class="input" placeholder="Stock #">
            <input id="vin" class="input wide" placeholder="VIN (optional)">
            <input id="photos" class="input wide" type="file" accept="image/*" multiple>
            <textarea id="notes" class="input full" rows="3" placeholder="Notes (condition, features, warranty, etc.)"></textarea>
          </div>

          <div class="adminActions">
            <button class="pill primary" type="button" onclick="saveVehicle()">Save Vehicle</button>
            <button class="pill" type="button" onclick="clearForm()">Clear Form</button>
            <button class="pill red" type="button" onclick="adminLogout()">Log out</button>
          </div>

          <div class="help" id="adminMsg"></div>
        </div>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="container footerGrid">
    <div class="small">
      <b style="color:#fff">EINSTEIN AUTO SALES LLC</b><br>
      401 S Tibbs Ave ‚Ä¢ Indianapolis, IN<br>
      Phone: (317) 492-9196<br><br>
      <span style="color:var(--muted)">¬© 2026 EINSTEIN AUTO SALES LLC</span>
    </div>
    <div class="small">
      <b style="color:#fff">Quick Links</b><br>
      <a class="pill ghost" href="#inventory" style="display:inline-flex;margin-top:10px">Inventory</a>
      <a class="pill ghost" href="https://www.google.com/maps?q=401+S+Tibbs+Ave,+Indianapolis,+IN" target="_blank" rel="noopener" style="display:inline-flex;margin-top:10px">Directions</a>
      <a class="pill ghost" href="tel:3174929196" style="display:inline-flex;margin-top:10px">Call</a>
    </div>
  </div>
</footer>

<!-- Vehicle modal -->
<div class="modalWrap" id="modalWrap" onclick="if(event.target===this) closeModal()">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modalTop">
      <b id="mTitle">Vehicle</b>
      <button class="modalClose" type="button" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modalBody">
      <div class="gallery">
        <div class="gMain" id="gMain"></div>
        <div class="gThumbs" id="gThumbs"></div>
      </div>
      <div class="details">
        <div class="dTitle" id="dTitle">‚Äî</div>
        <div class="dSub" id="dSub">‚Äî</div>

        <div class="dGrid" id="dGrid"></div>

        <div class="modalBtns">
          <a class="pill primary" href="tel:3174929196">Call Now</a>
          <a class="pill" href="https://www.google.com/maps?q=401+S+Tibbs+Ave,+Indianapolis,+IN" target="_blank" rel="noopener">Directions</a>
        </div>

        <div class="noteBox" id="dNotes" style="display:none"></div>

        <div class="adminActions" id="modalAdmin" style="display:none;margin-top:14px">
          <button class="pill" type="button" onclick="editVehicle()">Edit</button>
          <button class="pill red" type="button" onclick="deleteVehicle()">Delete</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Admin Login modal (simple) -->
<div class="modalWrap" id="loginWrap" onclick="if(event.target===this) closeLogin()">
  <div class="modal" style="max-width:520px;margin:80px auto" role="dialog" aria-modal="true">
    <div class="modalTop">
      <b>Admin Login</b>
      <button class="modalClose" type="button" onclick="closeLogin()">‚úï</button>
    </div>
    <div class="details" style="padding:16px">
      <div class="help">Enter credentials to manage inventory.</div>
      <div class="grid" style="margin-top:12px">
        <input id="u" class="input" placeholder="Username">
        <input id="p" class="input" placeholder="Password" type="password">
        <button class="pill red" type="button" onclick="adminLogin()">Login</button>
        <div class="help" id="loginMsg"></div>
      </div>
    </div>
  </div>
</div>

<script>
/* =========================
   CONFIG
========================= */
const PHONE = "3174929196";
const ADMIN_USER = "superjavi";
const ADMIN_PASS = "1520";
const STORE_KEY = "einstein_inventory_v1";
const ADMIN_KEY = "einstein_admin_session";

/* =========================
   STATE
========================= */
let isAdmin = sessionStorage.getItem(ADMIN_KEY) === "1";
let inventory = loadInventory();
let currentId = null; // selected vehicle for modal

/* =========================
   UTIL
========================= */
function $(id){ return document.getElementById(id); }
function esc(s){ return String(s ?? "").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m])); }
function toast(msg="Saved"){
  const t = $("toast");
  t.textContent = msg;
  t.style.display = "block";
  clearTimeout(toast._t);
  toast._t = setTimeout(()=>t.style.display="none", 950);
}
function money(n){
  const x = Number(String(n||"").replace(/[^0-9.]/g,""));
  if(!isFinite(x) || x<=0) return "";
  return "$" + x.toLocaleString();
}
function miles(n){
  const x = Number(String(n||"").replace(/[^0-9]/g,""));
  if(!isFinite(x) || x<=0) return "";
  return x.toLocaleString() + " mi";
}

/* =========================
   MENU
========================= */
function toggleMenu(){
  $("nav").classList.toggle("open");
}

/* =========================
   STORAGE
========================= */
function loadInventory(){
  try{
    const raw = localStorage.getItem(STORE_KEY);
    const arr = raw ? JSON.parse(raw) : [];
    return Array.isArray(arr) ? arr : [];
  }catch{
    return [];
  }
}
function saveInventory(){
  localStorage.setItem(STORE_KEY, JSON.stringify(inventory));
}

/* =========================
   INVENTORY RENDER
========================= */
function renderInventory(){
  const grid = $("invGrid");
  const q = ($("q")?.value || "").trim().toLowerCase();
  const sort = $("sort")?.value || "newest";
  const filter = $("filter")?.value || "all";

  let list = [...inventory];

  // filter
  if(filter !== "all"){
    list = list.filter(v => (v.status || "Available").toLowerCase() === filter);
  }

  // search
  if(q){
    list = list.filter(v=>{
      const hay = [
        v.year, v.make, v.model, v.trim, v.color, v.miles,
        v.engine, v.trans, v.drive, v.price, v.stock, v.vin,
        v.status, v.notes
      ].join(" ").toLowerCase();
      return hay.includes(q);
    });
  }

  // sort
  const num = (x)=> Number(String(x||"").replace(/[^0-9.]/g,"")) || 0;
  list.sort((a,b)=>{
    if(sort==="priceAsc") return num(a.price)-num(b.price);
    if(sort==="priceDesc") return num(b.price)-num(a.price);
    if(sort==="milesAsc") return num(a.miles)-num(b.miles);
    if(sort==="milesDesc") return num(b.miles)-num(a.miles);
    // newest default
    return (b.createdAt||0)-(a.createdAt||0);
  });

  $("invHint").textContent =
    list.length ? `${list.length} vehicle(s) shown.` :
    `No vehicles yet. ${isAdmin ? "Add one in Admin Panel." : ""}`;

  grid.innerHTML = "";
  list.forEach(v=>{
    const title = `${v.year||""} ${v.make||""} ${v.model||""}`.trim() || "Vehicle";
    const meta = [
      v.color ? v.color : "",
      v.engine ? v.engine : "",
      v.trans ? v.trans : "",
      v.drive ? v.drive : ""
    ].filter(Boolean).join(" ‚Ä¢ ");

    const cover = (v.photos && v.photos.length) ? v.photos[0] : "";
    const tPrice = v.price ? `<span class="tag">Price</span>` : "";
    const tMiles = v.miles ? `<span class="tag">Miles</span>` : "";
    const tStatus = `<span class="tag">${esc((v.status||"Available").toUpperCase())}</span>`;
    const tVin = v.vin ? `<span class="tag">VIN</span>` : "";
    const priceBadge = v.price ? `<div class="priceBadge">${esc(money(v.price))}</div>` : "";
    const milesBadge = v.miles ? `<div class="milesBadge">${esc(miles(v.miles))}</div>` : "";

    grid.insertAdjacentHTML("beforeend", `
      <div class="vehicleCard">
        <div class="thumb" onclick="openVehicle('${esc(v.id)}')">
          ${priceBadge}${milesBadge}
          ${cover ? `<img src="${esc(cover)}" alt="${esc(title)}">` : `<div class="noimg">No photo</div>`}
        </div>
        <div class="vBody">
          <div class="vTitle">${esc(title)}${v.trim ? ` <span style="color:var(--muted);font-weight:950">‚Ä¢ ${esc(v.trim)}</span>` : ""}</div>
          <div class="vMeta">${esc(meta || "Details available")}</div>
          <div class="tags">
            ${tStatus}${tPrice}${tMiles}${tVin}
          </div>
        </div>
        <div class="vActions">
          <button class="smallBtn primary" type="button" onclick="openVehicle('${esc(v.id)}')">Details</button>
          ${isAdmin
            ? `<button class="smallBtn danger" type="button" onclick="openVehicle('${esc(v.id)}'); setTimeout(()=>scrollToAdminButtons(), 50)">Manage</button>`
            : `<button class="smallBtn" type="button" onclick="callNow()">Call</button>`
          }
        </div>
      </div>
    `);
  });
}

function callNow(){
  location.href = "tel:" + PHONE;
}

/* =========================
   VEHICLE MODAL
========================= */
function openVehicle(id){
  const v = inventory.find(x=>x.id===id);
  if(!v) return;

  currentId = id;
  $("modalWrap").style.display = "block";

  const title = `${v.year||""} ${v.make||""} ${v.model||""}`.trim() || "Vehicle";
  $("mTitle").textContent = title;
  $("dTitle").textContent = title + (v.trim ? " ‚Ä¢ " + v.trim : "");
  $("dSub").textContent = [
    v.status ? v.status : "Available",
    v.stock ? "Stock " + v.stock : "",
    v.vin ? "VIN " + v.vin : ""
  ].filter(Boolean).join(" ‚Ä¢ ");

  // gallery
  const photos = (v.photos && v.photos.length) ? v.photos : [];
  renderGallery(photos);

  // details grid
  const items = [
    ["Price", money(v.price)],
    ["Miles", miles(v.miles)],
    ["Color", v.color],
    ["Engine", v.engine],
    ["Transmission", v.trans],
    ["Drivetrain", v.drive]
  ];
  $("dGrid").innerHTML = items.map(([k,val])=>`
    <div class="dItem">
      <div class="k">${esc(k)}</div>
      <div class="v">${esc(val || "‚Äî")}</div>
    </div>
  `).join("");

  // notes
  if(v.notes && v.notes.trim()){
    $("dNotes").style.display = "block";
    $("dNotes").textContent = v.notes;
  }else{
    $("dNotes").style.display = "none";
  }

  // admin buttons
  $("modalAdmin").style.display = isAdmin ? "flex" : "none";
}

function renderGallery(photos){
  const main = $("gMain");
  const thumbs = $("gThumbs");
  main.innerHTML = photos.length ? `<img src="${esc(photos[0])}" alt="Photo">` : `<div class="noimg" style="height:360px">No photos</div>`;
  thumbs.innerHTML = "";

  photos.forEach((src, idx)=>{
    thumbs.insertAdjacentHTML("beforeend", `<img src="${esc(src)}" alt="Thumb" ${idx===0?'class="active"':''} onclick="setMainPhoto(${idx})">`);
  });

  // store current photo set on element
  thumbs._photos = photos;
}

function setMainPhoto(idx){
  const photos = $("gThumbs")._photos || [];
  if(!photos[idx]) return;
  $("gMain").innerHTML = `<img src="${esc(photos[idx])}" alt="Photo">`;
  Array.from($("gThumbs").querySelectorAll("img")).forEach((im,i)=>{
    im.classList.toggle("active", i===idx);
  });
}

function closeModal(){
  $("modalWrap").style.display = "none";
  currentId = null;
}

function scrollToAdminButtons(){
  const el = $("modalAdmin");
  if(el) el.scrollIntoView({behavior:"smooth", block:"start"});
}

/* =========================
   ADMIN LOGIN
========================= */
function openLogin(){ $("loginWrap").style.display="block"; $("loginMsg").textContent=""; }
function closeLogin(){ $("loginWrap").style.display="none"; }

function adminLogin(){
  const u = ($("u").value||"").trim();
  const p = ($("p").value||"").trim();
  if(u===ADMIN_USER && p===ADMIN_PASS){
    isAdmin = true;
    sessionStorage.setItem(ADMIN_KEY, "1");
    $("loginWrap").style.display = "none";
    $("u").value=""; $("p").value="";
    showAdminUI();
    toast("Admin ON");
  }else{
    $("loginMsg").textContent = "Invalid login.";
  }
}

function adminLogout(){
  isAdmin = false;
  sessionStorage.removeItem(ADMIN_KEY);
  hideAdminUI();
  toast("Admin OFF");
}

function showAdminUI(){
  $("adminBar").style.display = "block";
  renderInventory();
}
function hideAdminUI(){
  $("adminBar").style.display = "none";
  renderInventory();
}

/* =========================
   ADMIN CRUD
========================= */
function clearForm(){
  ["status","year","make","model","trim","price","miles","color","engine","trans","drive","stock","vin","notes"].forEach(id=>{
    if($(id)) $(id).value="";
  });
  if($("photos")) $("photos").value = "";
  $("adminMsg").textContent = "";
  $("adminBar").setAttribute("data-editing", "");
  $("adminBar").setAttribute("data-id", "");
  toast("Cleared");
}

async function readFilesAsDataUrls(fileList){
  const files = Array.from(fileList || []);
  const out = [];
  for(const f of files){
    // compress by drawing to canvas
    const dataUrl = await fileToCompressedDataUrl(f, 1400, 0.82);
    out.push(dataUrl);
  }
  return out;
}

function fileToCompressedDataUrl(file, maxW=1400, quality=0.82){
  return new Promise((resolve, reject)=>{
    const fr = new FileReader();
    fr.onload = ()=>{
      const img = new Image();
      img.onload = ()=>{
        const scale = Math.min(1, maxW / img.width);
        const w = Math.round(img.width * scale);
        const h = Math.round(img.height * scale);

        const c = document.createElement("canvas");
        c.width = w; c.height = h;
        const ctx = c.getContext("2d");
        ctx.drawImage(img, 0, 0, w, h);
        resolve(c.toDataURL("image/jpeg", quality));
      };
      img.onerror = reject;
      img.src = fr.result;
    };
    fr.onerror = reject;
    fr.readAsDataURL(file);
  });
}

async function saveVehicle(){
  if(!isAdmin) return;

  const editingId = $("adminBar").getAttribute("data-id") || "";

  const v = {
    id: editingId || crypto.randomUUID(),
    status: ($("status").value || "Available").trim() || "Available",
    year: ($("year").value||"").trim(),
    make: ($("make").value||"").trim(),
    model: ($("model").value||"").trim(),
    trim: ($("trim").value||"").trim(),
    price: ($("price").value||"").trim(),
    miles: ($("miles").value||"").trim(),
    color: ($("color").value||"").trim(),
    engine: ($("engine").value||"").trim(),
    trans: ($("trans").value||"").trim(),
    drive: ($("drive").value||"").trim(),
    stock: ($("stock").value||"").trim(),
    vin: ($("vin").value||"").trim(),
    notes: ($("notes").value||"").trim(),
    createdAt: editingId ? (inventory.find(x=>x.id===editingId)?.createdAt || Date.now()) : Date.now(),
    updatedAt: Date.now(),
    photos: []
  };

  // photos: keep existing if editing unless new photos uploaded
  const existing = editingId ? (inventory.find(x=>x.id===editingId)?.photos || []) : [];
  const files = $("photos").files;
  if(files && files.length){
    try{
      const imgs = await readFilesAsDataUrls(files);
      v.photos = imgs;
    }catch{
      v.photos = existing;
    }
  }else{
    v.photos = existing;
  }

  // basic validation (avoid empty cars)
  const title = `${v.year} ${v.make} ${v.model}`.trim();
  if(!title){
    $("adminMsg").textContent = "Add at least Year/Make/Model.";
    return;
  }

  const idx = inventory.findIndex(x=>x.id===v.id);
  if(idx >= 0) inventory[idx] = v;
  else inventory.unshift(v);

  saveInventory();
  renderInventory();

  $("adminMsg").textContent = editingId ? "Updated." : "Saved.";
  $("adminBar").setAttribute("data-id", v.id);
  $("adminBar").setAttribute("data-editing", "1");
  toast(editingId ? "Updated" : "Saved");
}

function editVehicle(){
  if(!isAdmin || !currentId) return;
  const v = inventory.find(x=>x.id===currentId);
  if(!v) return;

  closeModal();
  $("adminBar").scrollIntoView({behavior:"smooth", block:"start"});

  $("adminBar").setAttribute("data-id", v.id);
  $("adminBar").setAttribute("data-editing", "1");

  $("status").value = v.status || "Available";
  $("year").value = v.year || "";
  $("make").value = v.make || "";
  $("model").value = v.model || "";
  $("trim").value = v.trim || "";
  $("price").value = v.price || "";
  $("miles").value = v.miles || "";
  $("color").value = v.color || "";
  $("engine").value = v.engine || "";
  $("trans").value = v.trans || "";
  $("drive").value = v.drive || "";
  $("stock").value = v.stock || "";
  $("vin").value = v.vin || "";
  $("notes").value = v.notes || "";
  $("photos").value = "";

  $("adminMsg").textContent = "Editing: " + `${v.year||""} ${v.make||""} ${v.model||""}`.trim();
  toast("Edit mode");
}

function deleteVehicle(){
  if(!isAdmin || !currentId) return;
  const v = inventory.find(x=>x.id===currentId);
  if(!v) return;

  if(!confirm("Delete this vehicle?")) return;

  inventory = inventory.filter(x=>x.id!==currentId);
  saveInventory();
  closeModal();
  renderInventory();
  toast("Deleted");
}

/* =========================
   INIT
========================= */
function init(){
  if(isAdmin) showAdminUI();
  else hideAdminUI();
  renderInventory();
}
init();
</script>
</body>
</html>


